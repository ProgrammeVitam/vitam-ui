<mat-sidenav-container [autosize]="true" [hasBackdrop]="false">
  <mat-sidenav mode="side" [fixedInViewport]="true" [opened]="false" *ngIf="foundAccessContract" vitamuiCommonResizeSidebar="left">
  </mat-sidenav>

  <mat-sidenav
    [ngClass]="isLPExtended ? 'extended-lateral-panel' : 'normal-lateral-panel'"
    #panel
    mode="side"
    position="end"
    [fixedInViewport]="true"
  >
    <app-archive-preview *ngIf="openedItem" (previewClose)="closePanel()"
            (showExtendedLateralPanel)="showExtendedLateralPanel()" [archiveUnit]="openedItem"
            [accessContract]="accessContract" (backToNormalLateralPanel)="backToNormalLateralPanel()"
            [hasAccessContractManagementPermissions]="hasAccessContractManagementPermissions"
            [hasUpdateDescriptiveUnitMetadataRole]="hasUpdateDescriptiveUnitMetadataRole"></app-archive-preview>
  </mat-sidenav>

  <mat-sidenav-content>
    <div class="vitamui-heading">
      <vitamui-common-title-breadcrumb> {{ 'COLLECT.TITLE_SEARCH_AREA' | translate }} : {{ projectId }} </vitamui-common-title-breadcrumb>
    </div>
    <div class="vitamui-content" *ngIf="foundAccessContract">
      <div class="row justify-content-around">
        <div class="col-8 form-control">
          <app-title-and-description-criteria-search-collect> </app-title-and-description-criteria-search-collect>
        </div>
        <div class="col-1 form-control"></div>
        <div class="col-3 form-control text-right">
          <button
            type="button"
            class="btn primary"
            [disabled]="!(searchCriteriaKeys && searchCriteriaKeys.length !== 0)"
            (click)="submit()"
          >
            {{ 'COLLECT.LAUNCH_SEARCH_ACTION' | translate }}
          </button>
        </div>
      </div>

      <div vitamuiCommonInfiniteScroll (vitamuiScroll)="loadMore()">
        <div class="vitamui-table">
          <div class="vitamui-table-head">
            <div class="col-8">
              <mat-spinner *ngIf="pendingGetFixedCount || pending" diameter="20" color="accent" class="spinner-wrapper"></mat-spinner>
              {{ totalResults }} {{ 'COLLECT.RESULTS' | translate }}
            </div>
          </div>

          <div class="vitamui-table-head">
            <div class="col-1 d-flex align-items-center">
              <input
                class="criteria-choice-input"
                type="checkbox"
                [checked]="isAllchecked"
                [indeterminate]="isIndeterminate"
                (change)="checkParentBoxChange($event)"
              />
            </div>

            <div class="col-1 d-flex align-items-center">
              <span>{{ 'COLLECT.ARCHIVE_UNIT.FIELDS.TYPE' | translate }}</span>

              <vitamui-common-order-by-button
                orderByKey="#unitType"
                [(orderBy)]="orderBy"
                [(direction)]="direction"
                (orderChange)="emitOrderChange()"
              >
              </vitamui-common-order-by-button>
            </div>

            <div class="col-4 d-flex align-items-center">
              <span
                >{{ 'COLLECT.ARCHIVE_UNIT.FIELDS.NAME' | translate }} <br />{{
                  'COLLECT.ARCHIVE_UNIT.FIELDS.DESCRIPTION' | translate
                }}</span
              >

              <vitamui-common-order-by-button
                orderByKey="Title"
                [(orderBy)]="orderBy"
                [(direction)]="direction"
                (orderChange)="emitOrderChange()"
              >
              </vitamui-common-order-by-button>
            </div>

            <div class="col-2 d-flex align-items-center">
              <span>{{ 'COLLECT.ARCHIVE_UNIT.FIELDS.START_DATE' | translate }} </span>
              <vitamui-common-order-by-button
                orderByKey="StartDate"
                [(orderBy)]="orderBy"
                [(direction)]="direction"
                (orderChange)="emitOrderChange()"
              >
              </vitamui-common-order-by-button>
            </div>

            <div class="col-2 d-flex align-items-center">
              <span>{{ 'COLLECT.ARCHIVE_UNIT.FIELDS.END_DATE' | translate }} </span>
              <vitamui-common-order-by-button
                orderByKey="EndDate"
                [(orderBy)]="orderBy"
                [(direction)]="direction"
                (orderChange)="emitOrderChange()"
              >
              </vitamui-common-order-by-button>
            </div>

            <div class="col-2 d-flex align-items-center">
              <span>{{ 'COLLECT.ARCHIVE_UNIT.FIELDS.SP' | translate }}</span>
              <vitamui-common-order-by-button
                orderByKey="#originating_agencies"
                [(orderBy)]="orderBy"
                [(direction)]="direction"
                (orderChange)="emitOrderChange()"
              >
              </vitamui-common-order-by-button>
            </div>
          </div>

          <div class="vitamui-table-body">
            <div class="vitamui-table-rows" *ngFor="let archiveUnit of archiveUnits">
              <div class="vitamui-row d-flex align-items-center">
                <div class="col-1 d-flex align-items-center">
                  <input
                    class="criteria-choice-input"
                    type="checkbox"
                    (click)="checkChildrenBoxChange(archiveUnit['#id'], $event)"
                    [checked]="isAllchecked"
                  />
                </div>
                <div class="col-1 d-flex align-items-center clickable" (click)="openPanel(archiveUnit)">
                  <span class="table-filter-icon" [ngSwitch]="archiveUnit?.DescriptionLevel">
                    <ng-container *ngSwitchCase="'RecordGrp'">
                      <i class="vitamui-icon vitamui-icon-folder vitamui-row-icon status-badge"></i>
                    </ng-container>
                    <ng-container *ngSwitchCase="'File'">
                      <i class="vitamui-icon vitamui-icon-file vitamui-row-icon status-badge"></i>
                    </ng-container>
                    <ng-container *ngSwitchCase="'Item'">
                      <i class="vitamui-icon vitamui-icon-file vitamui-row-icon status-badge"></i>
                    </ng-container>
                    <ng-container *ngSwitchCase="'Collection'">
                      <i class="vitamui-icon vitamui-icon-folder vitamui-row-icon status-badge"></i>
                    </ng-container>
                    <ng-container *ngSwitchCase="'Subfonds'">
                      <i class="vitamui-icon vitamui-icon-folder vitamui-row-icon status-badge"></i>
                    </ng-container>
                    <ng-container *ngSwitchCase="'Class'">
                      <i class="vitamui-icon vitamui-icon-folder vitamui-row-icon status-badge"></i>
                    </ng-container>
                    <ng-container *ngSwitchCase="'Subgrp'">
                      <i class="vitamui-icon vitamui-icon-folder vitamui-row-icon status-badge"></i>
                    </ng-container>
                    <ng-container *ngSwitchCase="'Otherlevel'">
                      <i class="vitamui-icon vitamui-icon-folder vitamui-row-icon status-badge"></i>
                    </ng-container>
                    <ng-container *ngSwitchCase="'Series'">
                      <i class="vitamui-icon vitamui-icon-folder vitamui-row-icon status-badge"></i>
                    </ng-container>
                    <ng-container *ngSwitchCase="'Subseries'">
                      <i class="vitamui-icon vitamui-icon-folder vitamui-row-icon status-badge"></i>
                    </ng-container>
                    <ng-container *ngSwitchCase="'Fonds'">
                      <i class="vitamui-icon vitamui-icon-folder vitamui-row-icon status-badge"></i>
                    </ng-container>
                    <ng-container *NgSwitchDefault>
                      <i class="vitamui-icon vitamui-icon-folder vitamui-row-icon status-badge"></i>
                    </ng-container>
                  </span>
                </div>
                <div class="col-4 d-flex align-items-center clickable" (click)="openPanel(archiveUnit)">
                  <ng-container *ngIf="archiveUnit?.Title; else subTitleFr">
                    <p matTooltip="{{ archiveUnit?.Description }}" matTooltipClass="vitamui-tooltip" [matTooltipShowDelay]="300">
                      <b> {{ archiveUnit?.Title }}</b> <br />
                      {{ archiveUnit?.Description | truncate: 100 }}
                    </p>
                  </ng-container>
                  <ng-template #subTitleFr>
                    <ng-container *ngIf="archiveUnit.Title_.fr; else subTitleEn">
                      <p matTooltip="{{ archiveUnit?.Description_?.fr }}" matTooltipClass="vitamui-tooltip" [matTooltipShowDelay]="300">
                        <b>{{ archiveUnit.Title_.fr }} </b> <br />
                        {{ archiveUnit?.Description_?.fr | truncate: 100 }}
                      </p>
                    </ng-container>
                  </ng-template>
                  <ng-template #subTitleEn>
                    <ng-container *ngIf="archiveUnit.Title_.en">
                      <p matTooltip="{{ archiveUnit?.Description_?.en }}" matTooltipClass="vitamui-tooltip" [matTooltipShowDelay]="300">
                        <b>{{ archiveUnit.Title_.en }} </b> <br />
                        {{ archiveUnit?.Description_?.en | truncate: 100 }}
                      </p>
                    </ng-container>
                  </ng-template>
                </div>
                <div class="col-2 d-flex align-items-center clickable" (click)="openPanel(archiveUnit)">
                  {{ archiveUnit['#approximate_creation_date'] | dateTime: 'dd/MM/yyyy' }}
                </div>
                <div class="col-2 d-flex align-items-center clickable" (click)="openPanel(archiveUnit)">
                  {{ archiveUnit['#approximate_update_date'] | dateTime: 'dd/MM/yyyy' }}
                </div>
                <div class="col-2 d-flex align-items-center clickable" (click)="openPanel(archiveUnit)">
                  <p
                    matTooltip="{{ archiveUnit['#originating_agency'] }}   ({{ archiveUnit['#originating_agencies'] }})"
                    matTooltipClass="vitamui-tooltip"
                    [matTooltipShowDelay]="300"
                  >
                    {{ archiveUnit['#originating_agency'] }}
                  </p>
                </div>
              </div>
            </div>
          </div>
          <div class="vitamui-table-footer">
            <mat-spinner *ngIf="pending" diameter="50" color="accent"></mat-spinner>
            <button *ngIf="!pending && canLoadMore" (click)="loadMore()" class="btn">
              {{ 'COLLECT.SHOW_MORE_RESULTS' | translate }}
            </button>
            <span *ngIf="!pending && !canLoadMore">{{ 'COLLECT.NO_MORE_RESULTS' | translate }}</span>
          </div>
        </div>
      </div>
    </div>
  </mat-sidenav-content>
</mat-sidenav-container>
