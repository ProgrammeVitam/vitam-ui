<div class="header">
  <vitamui-common-progress-bar [count]="stepCount" [index]="stepIndex"></vitamui-common-progress-bar>
</div>

<form [formGroup]="projectForm">
  <vitamui-common-stepper [selectedIndex]="stepIndex">
    <!-- Step 1 : Upload fichiers -->
    <cdk-step>
      <div class="content">
        <h2>{{ 'COLLECT.UPLOAD_TITLE' | translate }}</h2>
        <h4>{{ 'COLLECT.UPLOAD_SUB_TITLE' | translate }}</h4>
        <div class="d-flex">
          <div
            (dragleave)="onDragLeave($event)"
            (dragover)="onDragOver($event)"
            (drop)="onDropped($event)"
            [ngClass]="{ 'on-over': hasDropZoneOver }"
            class="drag-and-drop-area"
          >
            <div *ngIf="(uploadFiles$ | async)?.length > 0" class="drag-container">
              <div class="file-info-class">
                <div class="vitamui-chip-list">
                  <div *ngFor="let uploadFile of uploadFiles$ | async" class="vitamui-chip">
                    <div [title]="uploadFile" class="vitamui-chip-content">
                      {{ uploadFile?.name }}
                      <span class="file-size">{{ uploadFile?.size | bytes }}</span>
                    </div>
                    <div (click)="removeFolder(uploadFile)" class="vitamui-remove-chip">
                      <i class="material-icons">clear</i>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <input #fileSearch (change)="handleFile($event)" class="input-file" directory multiple type="file" webkitdirectory />
            <div class="drop-area">
              <div class="sip-drop">{{ 'COLLECT.UPLOAD.ADD_FILE' | translate }} <br /></div>
              <div>
                <div class="sip-drop">
                  <div class="upload">
                    <span (click)="addFolder()" class="url-select">{{ 'COLLECT.UPLOAD.BROWSE' | translate }}</span>
                  </div>
                  <span class="sip-drop-small">{{ 'COLLECT.UPLOAD.ADD_FILE_DESCRIPTION' | translate }}</span>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="actions">
          <button (click)="move()" [disabled]="(uploadFiles$ | async)?.length === 0" class="btn primary" type="button">
            {{ 'COMMON.NEXT' | translate }}
          </button>
          <button (click)="onClose()" class="btn link" type="button">{{ 'COMMON.UNDO' | translate }}</button>
        </div>
      </div>
    </cdk-step>

    <!-- Step 2 : Rattachement des archives à une position -->
    <cdk-step>
      <div class="content">
        <h2>{{ 'COLLECT.ARCHIVE_POSITION_TITLE' | translate }}</h2>
        <h4>{{ 'COLLECT.ARCHIVE_POSITION_SUB_TITLE' | translate }}</h4>
        <div class="d-flex">
          <div class="form-group">
            <vitamui-library-filing-plan
              [accessContract]="accessContractSelect.value"
              [formControl]="linkParentIdControl"
              [mode]="FILLING_PLAN_MODE.SOLO"
              [tenantIdentifier]="tenantIdentifier"
            ></vitamui-library-filing-plan>
          </div>
        </div>
        <div class="actions">
          <button (click)="validateAndProcessUpload()" class="btn primary" type="button">{{ 'COMMON.NEXT' | translate }}</button>
          <button (click)="onClose()" class="btn link" type="button">{{ 'COMMON.UNDO' | translate }}</button>
        </div>
      </div>
    </cdk-step>

    <!-- Step 3 : Description du versement -->
    <cdk-step>
      <div class="content">
        <h2>{{ 'COLLECT.PROJECT_DESCRIPTION_TITLE' | translate }}</h2>
        <h4>{{ 'COLLECT.PROJECT_DESCRIPTION_SUB_TITLE' | translate }}</h4>
        <div>
          <vitamui-common-input
            class="col-12"
            formControlName="messageIdentifier"
            placeholder="{{ 'COLLECT.PROJECT_DESCRIPTION_LABEL' | translate }}"
            required
          >
          </vitamui-common-input>
          <vitamui-common-textarea
            class="col-12"
            formControlName="comment"
            placeholder="{{ 'COLLECT.PROJECT_DESCRIPTION_DESC' | translate }}"
          >
          </vitamui-common-textarea>

          <div class="col-12 mt-4 mb-3">
            <div class="row">
              <div class="col-7">
                <h4>{{ 'COLLECT.PROJECT_DESCRIPTION_SERVICES' | translate }}</h4>
              </div>
              <div class="col-5 mt-2">
                <vitamui-common-slide-toggle
                  class="fields-padding"
                  [disabled]="true"
                  formControlName="referentialCheckup"
                  matTooltipPosition="below"
                >
                  {{ 'COLLECT.PROJECT_DESCRIPTION_REFERENTIAL_CHECKUP' | translate }}
                </vitamui-common-slide-toggle>
              </div>
            </div>
          </div>
          <vitamui-common-input
            class="col-5"
            formControlName="originatingAgencyIdentifier"
            placeholder="{{ 'COLLECT.PROJECT_DESCRIPTION_ORIGINATING_AGENCY' | translate }}"
            required
          >
          </vitamui-common-input>
          <vitamui-common-input
            [disabled]="true"
            class="col-6 offset-1"
            placeholder="{{ 'COLLECT.PROJECT_DESCRIPTION_ORIGINATING_AGENCY' | translate }}"
          >
          </vitamui-common-input>
          <vitamui-common-input
            class="col-5"
            formControlName="submissionAgencyIdentifier"
            placeholder="{{ 'COLLECT.PROJECT_DESCRIPTION_SUBMISSION_AGENCY' | translate }}"
            required
          >
          </vitamui-common-input>
          <vitamui-common-input
            [disabled]="true"
            class="col-6 offset-1"
            placeholder="{{ 'COLLECT.PROJECT_DESCRIPTION_SUBMISSION_AGENCY' | translate }}"
          >
          </vitamui-common-input>
        </div>
        <div class="actions">
          <button (click)="move()" [disabled]="validateThirdStep()" class="btn primary" type="button">
            {{ 'COMMON.NEXT' | translate }}
          </button>
          <button (click)="onCancel()" class="btn link" type="button">{{ 'COMMON.UNDO' | translate }}</button>
        </div>
      </div>
    </cdk-step>

    <!-- Step 4 : Contexte du versement -->
    <cdk-step>
      <div class="content">
        <div class="col-12 mt-4 mb-3">
          <div class="row">
            <div class="col-7">
              <h4>{{ 'COLLECT.PROJECT_CONTEXT_SUB_TITLE' | translate }}</h4>
            </div>
            <div class="col-5 mt-2">
              <vitamui-common-slide-toggle
                class="fields-padding"
                [disabled]="true"
                formControlName="referentialCheckup"
                matTooltipPosition="below"
              >
                {{ 'COLLECT.PROJECT_DESCRIPTION_REFERENTIAL_CHECKUP' | translate }}
              </vitamui-common-slide-toggle>
            </div>
          </div>
        </div>
        <div>
          <vitamui-common-input
            class="col-5"
            formControlName="archivalAgencyIdentifier"
            placeholder="{{ 'COLLECT.PROJECT_CONTEXT_ARCHIVAL_AGENCY' | translate }}"
            required
          >
          </vitamui-common-input>
          <vitamui-common-input
            [disabled]="true"
            class="col-6 offset-1"
            placeholder="{{ 'COLLECT.PROJECT_CONTEXT_ARCHIVAL_AGENCY' | translate }}"
          >
          </vitamui-common-input>
          <vitamui-common-input
            class="col-5"
            formControlName="transferringAgencyIdentifier"
            placeholder="{{ 'COLLECT.PROJECT_CONTEXT_TRANSFERRING_AGENCY' | translate }}"
            required
          >
          </vitamui-common-input>
          <vitamui-common-input
            [disabled]="true"
            class="col-6 offset-1"
            placeholder="{{ 'COLLECT.PROJECT_CONTEXT_TRANSFERRING_AGENCY' | translate }}"
          >
          </vitamui-common-input>
          <vitamui-common-input
            class="col-5"
            formControlName="archivalAgreement"
            placeholder="{{ 'COLLECT.PROJECT_CONTEXT_ARCHIVAL_AGREEMENT' | translate }}"
            required
          >
          </vitamui-common-input>
          <vitamui-common-input
            [disabled]="true"
            class="col-6 offset-1"
            placeholder="{{ 'COLLECT.PROJECT_CONTEXT_ARCHIVAL_AGREEMENT' | translate }}"
          >
          </vitamui-common-input>
          <vitamui-common-input
            class="col-5"
            formControlName="archiveProfile"
            placeholder="{{ 'COLLECT.PROJECT_CONTEXT_ARCHIVE_PROFILE' | translate }}"
          >
          </vitamui-common-input>
          <vitamui-common-input
            [disabled]="true"
            class="col-6 offset-1"
            placeholder="{{ 'COLLECT.PROJECT_CONTEXT_ARCHIVE_PROFILE' | translate }}"
          >
          </vitamui-common-input>

          <mat-form-field appearance="outline" class="col-12" id="acquisition-informations">
            <label for="acquisition-informations">
              <span class="pb-3">{{ 'COLLECT.PROJECT_CONTEXT_ACQUISITION_INFORMATION' | translate }}</span>
            </label>
            <mat-select formControlName="acquisitionInformation">
              <mat-option *ngFor="let acquisitionInformation of acquisitionInformationsList" [value]="acquisitionInformation">{{
                acquisitionInformation
              }}</mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline" class="col-12" id="legal-status">
            <label for="legal-status">
              <span class="pb-3">{{ 'COLLECT.PROJECT_CONTEXT_LEGAL_STATUS' | translate }}</span>
            </label>
            <mat-select formControlName="legalStatus">
              <mat-option *ngFor="let legalStatus of legalStatusList" [value]="legalStatus.id">{{ legalStatus.value }}</mat-option>
            </mat-select>
          </mat-form-field>
        </div>
        <div class="actions">
          <button type="button" class="btn link back" (click)="back()">
            <i class="vitamui-icon vitamui-icon-chevron-left"></i>
            <ng-container
              ><span class="underline">{{ 'COMMON.BACK' | translate }}</span></ng-container
            >
          </button>
          <button (click)="updateProject()" [disabled]="validateFourStep()" class="btn primary" type="button">
            {{ 'COMMON.SUBMIT' | translate }}
          </button>
          <button (click)="onCancel()" class="btn link" type="button">{{ 'COMMON.UNDO' | translate }}</button>
        </div>
      </div>
    </cdk-step>

    <!-- Step 5 : Téléchargements -->
    <cdk-step>
      <div class="content">
        <div class="row">
          <div class="col-11">
            <h2>{{ 'COLLECT.UPLOAD.TRACKING_TITLE' | translate }}</h2>
          </div>
        </div>
        <table class="vitamui-table">
          <thead>
            <tr>
              <th>{{ 'COLLECT.UPLOAD.ZIP_NAME' | translate }}</th>
              <th>{{ 'COLLECT.UPLOAD.WEIGHT' | translate }}</th>
              <th>{{ 'COLLECT.UPLOAD.ZIP_TRACKING_TITLE' | translate }}</th>
              <th>{{ 'COLLECT.UPLOAD.STATUS' | translate }}</th>
            </tr>
          </thead>
          <tbody>
            <tr class="vitamui-table-row">
              <td>{{ (zippedFile$ | async)?.name }}</td>
              <td>{{ (zippedFile$ | async)?.size | fileSize }}</td>
              <td>
                <span class="purcent">{{ (zippedFile$ | async)?.currentFileUploadedSize | number: '1.0-0' }} %</span>
                <mat-progress-bar
                  [value]="(zippedFile$ | async)?.currentFileUploadedSize"
                  class="stepper-progress-bar"
                  mode="determinate"
                ></mat-progress-bar>
              </td>
              <td>
                <span class="purcent">{{ (zippedFile$ | async)?.uploadedSize | number: '1.0-0' }} %</span>
                <mat-progress-bar
                  [value]="(zippedFile$ | async)?.uploadedSize"
                  class="stepper-progress-bar"
                  mode="determinate"
                ></mat-progress-bar>
              </td>
            </tr>
          </tbody>
        </table>
        <div class="actions">
          <button (click)="close()" [disabled]="!closeModal" class="btn primary" type="button">{{ 'COMMON.CLOSE' | translate }}</button>
        </div>
      </div>
    </cdk-step>
  </vitamui-common-stepper>
</form>

<ng-template #confirmDeleteAddRuleDialog>
  <mat-dialog-content>
    <br />

    <div class="text large bold">{{ 'UNIT_UPDATE.CONFIRM_CLOSE' | translate }}</div>
  </mat-dialog-content>
  <br />
  <mat-dialog-actions>
    <button (click)="onConfirm()" class="btn primary btn-confirm-dialog margin-btn">{{ 'UNIT_UPDATE.CLOSE' | translate }}</button>

    <button (click)="onClose()" class="btn cancel">{{ 'COMMON.UNDO' | translate }}</button>
  </mat-dialog-actions>
</ng-template>
