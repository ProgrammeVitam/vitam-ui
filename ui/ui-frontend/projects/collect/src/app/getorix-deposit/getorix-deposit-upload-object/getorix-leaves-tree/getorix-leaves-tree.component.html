<div class="tree-getorix-scheme">
  <mat-tree [dataSource]="nestedDataSourceLeaves" [treeControl]="nestedTreeControlLeaves" class="filing-holding-scheme-tree">
    <mat-nested-tree-node *matTreeNodeDef="let node; when: nodeIsUAWithChildren">
      <div
        *ngIf="nodeHasResultOrShowAll(node)"
        class="mat-tree-node getorix-schema-tree-node flex-row"
        [ngClass]="checkNodeClicked(node) ? 'node-selected' : 'node-not-selected'"
      >
        <span class="vertical-line" *ngIf="checkNodeClicked(node)"></span>
        <getorix-tree-node
          [node]="node"
          [icon]="getNodeUnitIcon(node)"
          (labelClickToSearchUnits)="onLabelClickToSearchUnitsOfNode(node)"
          [expanded]="nestedTreeControlLeaves.isExpanded(node)"
          (nodeToggle)="toggleLeave(node)"
        >
        </getorix-tree-node>
      </div>
      <div
        *ngIf="nodeHasResultOrShowAll(node)"
        [class.getorix-scheme-tree-invisible]="!nestedTreeControlLeaves.isExpanded(node)"
        class="flex-column childs"
      >
        <ng-container matTreeNodeOutlet *ngIf="nestedTreeControlLeaves.isExpanded(node)"></ng-container>
        <div *ngIf="node.isLoadingChildren">
          <mat-spinner diameter="20" color="accent"></mat-spinner>
        </div>
        <div *ngIf="canLoadMoreUAForNode(node) && nestedTreeControlLeaves.isExpanded(node)">
          <a class="load-more-ua" (click)="toggleLoadMore(node)">
            <i class="material-icons">add</i>
            {{ 'GETORIX_DEPOSIT.UPLOAD_ARCHIVES.TREE.LOAD_MORE_UNITS' | translate }}
          </a>
        </div>
      </div>
    </mat-nested-tree-node>

    <mat-tree-node *matTreeNodeDef="let node; when: nodeIsUAWithoutChildren">
      <div *ngIf="nodeHasResultOrShowAll(node)" class="mat-tree-node getorix-schema-tree-node flex-row">
        <div class="tree-text">
          <getorix-tree-node
            disabled
            [node]="node"
            [icon]="getNodeUnitIcon(node)"
            (labelClickToSearchUnits)="onLabelClickToSearchUnitsOfNode(node)"
            (nodeToggle)="nestedTreeControlLeaves.toggle(node)"
          >
          </getorix-tree-node>
        </div>
      </div>
    </mat-tree-node>

    <mat-nested-tree-node *matTreeNodeDef="let node; when: nodeIsOrphansNode">
      <div
        *ngIf="nodeHasResultOrShowAll(node)"
        class="mat-tree-node getorix-schema-tree-node flex-row"
        [ngClass]="checkNodeClicked(node) ? 'node-selected' : 'node-not-selected'"
      >
        <span class="vertical-line" *ngIf="checkNodeClicked(node)"></span>
        <getorix-tree-node
          [node]="node"
          [expanded]="nestedTreeControlLeaves.isExpanded(node)"
          (nodeToggle)="toggleOrphansNode(node)"
          (labelClickToSearchUnits)="onLabelClickToSearchUnitsOfNode(node)"
          (firstNodeToggle)="toggleOrphansNode(node)"
        >
        </getorix-tree-node>
      </div>
      <div
        *ngIf="nodeHasResultOrShowAll(node)"
        class="flex-column childs"
        [class.getorix-scheme-tree-invisible]="!nestedTreeControlLeaves.isExpanded(node)"
      >
        <ng-container matTreeNodeOutlet *ngIf="nestedTreeControlLeaves.isExpanded(node)"></ng-container>
        <div *ngIf="node.isLoadingChildren">
          <mat-spinner diameter="20" color="accent"></mat-spinner>
        </div>
        <div *ngIf="canLoadMoreUAForNode(node) && nestedTreeControlLeaves.isExpanded(node)">
          <a class="load-more-ua" (click)="toggleLoadMoreOrphans(node)">
            <i class="material-icons">add</i>
            {{ 'GETORIX_DEPOSIT.UPLOAD_ARCHIVES.TREE.LOAD_MORE_UNITS' | translate }}
          </a>
        </div>
      </div>
    </mat-nested-tree-node>

    <mat-nested-tree-node *matTreeNodeDef="let node">
      <div
        *ngIf="nodeHasResultOrShowAll(node)"
        class="mat-tree-node getorix-schema-tree-node"
        [ngClass]="checkNodeClicked(node) ? 'node-selected' : 'node-not-selected'"
      >
        <span class="vertical-line" *ngIf="checkNodeClicked(node)"></span>
        <getorix-tree-node
          [node]="node"
          [icon]="getNodeUnitIcon(node)"
          (labelClickToSearchUnits)="onLabelClickToSearchUnitsOfNode(node)"
          [expanded]="nestedTreeControlLeaves.isExpanded(node)"
          (nodeToggle)="toggleLeave(node)"
        >
        </getorix-tree-node>
      </div>
      <div
        *ngIf="nodeHasResultOrShowAll(node)"
        [class.getorix-scheme-tree-invisible]="!nestedTreeControlLeaves.isExpanded(node)"
        class="flex-column childs"
      >
        <ng-container matTreeNodeOutlet *ngIf="!node.isLoadingChilds && nestedTreeControlLeaves.isExpanded(node)"></ng-container>
        <div *ngIf="node.isLoadingChildren">
          <mat-spinner diameter="20" color="accent"></mat-spinner>
        </div>
        <div *ngIf="canLoadMoreUAForNode(node) && nestedTreeControlLeaves.isExpanded(node)">
          <a class="load-more-ua" (click)="toggleLoadMore(node)">
            <i class="material-icons">add</i>
            {{ 'GETORIX_DEPOSIT.UPLOAD_ARCHIVES.TREE.LOAD_MORE_UNITS' | translate }}
          </a>
        </div>
      </div>
    </mat-nested-tree-node>
  </mat-tree>
</div>
