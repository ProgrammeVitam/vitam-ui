<div class="header">
  <vitamui-common-progress-bar [count]="stepCount" [index]="stepIndex"></vitamui-common-progress-bar>
</div>

<form [formGroup]="form" (ngSubmit)="onSubmit()" (keydown.enter)="$event.preventDefault()">
  <vitamui-common-stepper (selectionChange)="stepIndex = $event.selectedIndex">


    <!-- STEP 3 - Format des fichiers : authorisés et identifiés -->
    <cdk-step>
      <div class="content">
        <h4>{{ 'INGEST_CONTRACT.MODAL_CREATE.TITLE' | translate }}</h4>
        <h2>{{ 'INGEST_CONTRACT.MODAL_CREATE.FILES_FORMAT.TITLE' | translate }}</h2>
        <div class="main-content">
          <div class="form-group">
            <div class="row">
              <div class="col-8 form-control">
                <vitamui-common-slide-toggle formControlName="everyFormatType">Tous les formats de fichiers
                </vitamui-common-slide-toggle>
                <i class="vitamui-icon vitamui-icon-info" matTooltipClass="vitamui-tooltip"
                   matTooltip="Autoriser tout les formats d'objets binaires existant dans le référentiel des formats"></i>
              </div>
            </div>

            <div class="row" *ngIf="form?.controls.everyFormatType?.value === false">
              <div class="form-control col-8">
                <mat-form-field class="vitamui-mat-select">
                  <mat-select
                    formControlName="formatType"
                    placeholder="Sélectionnez les formats de fichiers"
                    panelclass="vitamui-mat-select"
                    required
                    multiple
                  >
                    <mat-option *ngFor="let fileFormat of formatTypeList"
                                [value]="fileFormat.puid">{{ fileFormat.name }} </mat-option>
                  </mat-select>
                  <div class="select-arrow">
                    <i class="material-icons">keyboard_arrow_down</i>
                  </div>
                </mat-form-field>
              </div>
              <i class="vitamui-icon vitamui-icon-info" matTooltipClass="vitamui-tooltip"
                 matTooltip="Choisir les formats binaires que vous souhaitez autoriser"></i>
            </div>

            <div class="row">
              <div class="col-12 form-control">
                <vitamui-common-slide-toggle formControlName="formatUnidentifiedAuthorized">
                  Autoriser les formats non identifiés
                </vitamui-common-slide-toggle>
                <i class="vitamui-icon vitamui-icon-info" matTooltipClass="vitamui-tooltip"
                   matTooltip="Autoriser les formats d'objets binaires non référencés dans le référentiel des formats"></i>
              </div>
            </div>
          </div>
        </div>
        <div class="actions">
          <div class="line">
            <button type="button" class="btn primary" cdkStepperNext [disabled]="thirdStepInvalid()">
              {{ 'COMMON.NEXT' | translate }}
            </button>
            <button type="button" class="btn link" (click)="onCancel()">
              {{ 'COMMON.UNDO' | translate }}
            </button>
          </div>
          <button type="button" class="btn link back" cdkStepperPrevious>
            <i class="vitamui-icon vitamui-icon-chevron-left"></i>
            <span class="underline">{{ 'COMMON.BACK' | translate }}</span>
          </button>
        </div>
      </div>
    </cdk-step>

    <!-- STEP 4 - Objets : binaire obligatoire et usage -->
    <cdk-step>
      <div class="content">
        <h4>{{ 'INGEST_CONTRACT.MODAL_CREATE.TITLE' | translate }}</h4>
        <h2>{{ 'INGEST_CONTRACT.MODAL_CREATE.OBJECTS.TITLE' | translate }}</h2>
        <div class="main-content">
          <div class="form-group">
            <div class="row">
              <div class="col-6 form-control">
                <vitamui-common-slide-toggle formControlName="binaryObjectMandatory"
                >Original binaire obligatoire
                </vitamui-common-slide-toggle>
                <i class="vitamui-icon vitamui-icon-info" matTooltipClass="vitamui-tooltip"
                   matTooltip="Option permettant de rendre obligatoire ou non la présence d’un objet binaire de type « Master »"></i>
              </div>
            </div>
            <div class="row">
              <div class="col-4 form-)control">
                <vitamui-common-slide-toggle formControlName="everyDataObjectVersion">Tous usages autorisés
                </vitamui-common-slide-toggle>
                <div class="form-control" *ngIf="form?.controls.everyDataObjectVersion?.value === false">
                  <mat-form-field class="vitamui-mat-select">
                    <mat-select
                      formControlName="dataObjectVersion"
                      required="required"
                      placeholder="Sélectionnez les usages"
                      panelclass="vitamui-mat-select"
                      multiple
                    >
                      <mat-option *ngFor="let usage of usages" [value]="usage.key">
                        {{ usage.label }}
                      </mat-option>
                    </mat-select>
                    <div class="select-arrow">
                      <i class="material-icons">keyboard_arrow_down</i>
                    </div>
                  </mat-form-field>
                </div>
              </div>
              <div class="col-3">
                <i class="vitamui-icon vitamui-icon-info" matTooltipClass="vitamui-tooltip"
                   matTooltip="Usage(s) autorisé(s) dans le cas de l’ajout d’un objet binaire à un groupe d’objets techniques existant"></i>
              </div>
            </div>
          </div>
        </div>
        <div class="actions">
          <div class="line">
            <button type="button" class="btn primary" cdkStepperNext [disabled]="fourthStepInvalid()">
              {{ 'COMMON.NEXT' | translate }}
            </button>
            <button type="button" class="btn link" (click)="onCancel()">
              {{ 'COMMON.UNDO' | translate }}
            </button>
          </div>
          <button type="button" class="btn link back" cdkStepperPrevious>
            <i class="vitamui-icon vitamui-icon-chevron-left"></i>
            <span class="underline">{{ 'COMMON.BACK' | translate }}</span>
          </button>
        </div>
      </div>
    </cdk-step>

    <!-- STEP 5 - Héritage : calcul -->
    <cdk-step>
      <div class="content">
        <h4>{{ 'INGEST_CONTRACT.MODAL_CREATE.TITLE' | translate }}</h4>
        <h2>{{ 'INGEST_CONTRACT.MODAL_CREATE.INHERITANCE.TITLE' | translate }}</h2>
        <div class="main-content">
          <div class="form-group">
            <div class="row">
              <div class="col-12 form-control">
                <vitamui-common-slide-toggle formControlName="computeInheritedRulesAtIngest"
                >Calcul des héritages de règles et d'indexation des échéances
                </vitamui-common-slide-toggle>
                <i class="vitamui-icon vitamui-icon-info" matTooltipClass="vitamui-tooltip"
                   matTooltip="Indexation des unités archivistiques indiquée comme invalide lors de leur entrée afin
                qu'elles fassent l'objet d'un calcul lors d'un processus automatique déclenché périodiquement"></i>
              </div>
            </div>
          </div>
        </div>
        <div class="actions">
          <div class="line">
            <button type="button" class="btn primary" cdkStepperNext>
              {{ 'COMMON.NEXT' | translate }}
            </button>
            <button type="button" class="btn link" (click)="onCancel()">
              {{ 'COMMON.UNDO' | translate }}
            </button>
          </div>
          <button type="button" class="btn link back" cdkStepperPrevious>
            <i class="vitamui-icon vitamui-icon-chevron-left"></i>
            <span class="underline">{{ 'COMMON.BACK' | translate }}</span>
          </button>
        </div>
      </div>
    </cdk-step>

    <!-- STEP 6 - Position de rattachement : selecteur -->
    <cdk-step>
      <div class="content">
        <h4>{{ 'INGEST_CONTRACT.MODAL_CREATE.TITLE' | translate }}</h4>
        <h2>{{ 'INGEST_CONTRACT.MODAL_CREATE.ATTACHMENT_POSITION.TITLE' | translate }}
          <i class="vitamui-icon vitamui-icon-info" matTooltipClass="vitamui-tooltip"
             matTooltip="Ajouter si nécessaire la position de rattachement auquel on souhaite rattacher le SIP"></i>
        </h2>
        <div class="main-content">
          <div class="form-group">
            <vitamui-library-filing-plan
              [formControl]="linkParentIdControl"
              [tenantIdentifier]="tenantIdentifier"
              [accessContract]="accessContractSelect.value"
              [mode]="FILLING_PLAN_MODE.SOLO"
            ></vitamui-library-filing-plan>
          </div>
        </div>
        <div class="actions">
          <div class="line">
            <button type="button" class="btn primary" cdkStepperNext>
              {{ 'COMMON.NEXT' | translate }}
            </button>
            <button type="button" class="btn link" (click)="onCancel()">
              {{ 'COMMON.UNDO' | translate }}
            </button>
          </div>
          <button type="button" class="btn link back" cdkStepperPrevious>
            <i class="vitamui-icon vitamui-icon-chevron-left"></i>
            <span class="underline">{{ 'COMMON.BACK' | translate }}</span>
          </button>
        </div>
      </div>
    </cdk-step>

    <!-- STEP 7 - Contrôle des rattachements : selecteur -->
    <cdk-step>
      <div class="content">
        <h4>{{ 'INGEST_CONTRACT.MODAL_CREATE.TITLE' | translate }}</h4>
        <h2>{{ 'INGEST_CONTRACT.MODAL_CREATE.ATTACHMENT_CONTROLS.TITLE' | translate }}
          <i class="vitamui-icon vitamui-icon-info" matTooltipClass="vitamui-tooltip"
             matTooltip="Option permettant de contrôler la déclaration de rattachement dans un bordereau"></i>
        </h2>
        <div class="main-content">
          <div class="form-group">
            <div class="row">
              <div class="col">
                <vitamui-radio-group formControlName="checkParentLink">
                  <vitamui-radio matTooltipClass="vitamui-tooltip"
                                 [matTooltip]="'Autorisé un bordereau à contenir des nœuds sans que cela soit obligatoire'"
                                 label="Autorisé"
                                 value="AUTHORIZED"
                                 [checked]="true">
                  </vitamui-radio>
                  <vitamui-radio matTooltipClass="vitamui-tooltip"
                                 [matTooltip]="'Rend obligatoire la présence d\'au moins un nœud'"
                                 label="Obligatoire"
                                 value="REQUIRED">
                  </vitamui-radio>
                  <vitamui-radio matTooltipClass="vitamui-tooltip"
                                 [matTooltip]="'Interdit la présence de nœuds de rattachement dans le bordereau'"
                                 label="Interdit"
                                 value="UNAUTHORIZED">
                  </vitamui-radio>
                </vitamui-radio-group>
              </div>
            </div>
          </div>
        </div>
        <div class="actions">
          <div class="line">
            <button type="button" class="btn primary" cdkStepperNext>
              {{ 'COMMON.NEXT' | translate }}
            </button>
            <button type="button" class="btn link" (click)="onCancel()">
              {{ 'COMMON.UNDO' | translate }}
            </button>
          </div>
          <button type="button" class="btn link back" cdkStepperPrevious>
            <i class="vitamui-icon vitamui-icon-chevron-left"></i>
            <span class="underline">{{ 'COMMON.BACK' | translate }}</span>
          </button>
        </div>
      </div>
    </cdk-step>

    <!-- STEP 8 - Contrôle des rattachements -->
    <cdk-step>
      <div class="content">
        <h4>{{ 'INGEST_CONTRACT.MODAL_CREATE.TITLE' | translate }}</h4>
        <h2>{{ 'INGEST_CONTRACT.MODAL_CREATE.ATTACHMENT_CONTROLS.TITLE' | translate }}
          <i class="vitamui-icon vitamui-icon-info" matTooltipClass="vitamui-tooltip"
             matTooltip="Sélection des positions de l'arbre"></i>
        </h2>
        <div class="main-content">
          <div class="form-group">
            <vitamui-library-filing-plan
              [formControl]="checkParentIdControl"
              [tenantIdentifier]="tenantIdentifier"
              [accessContract]="accessContractSelect.value"
              [mode]="FILLING_PLAN_MODE.INCLUDE_ONLY"
              [required]="checkParentIdControl.value === 'REQUIRED'"
            ></vitamui-library-filing-plan>
          </div>
        </div>
        <div class="actions">
          <div class="line">
            <button type="button" class="btn primary" cdkStepperNext>
              {{ 'COMMON.NEXT' | translate }}
            </button>
            <button type="button" class="btn link" (click)="onCancel()">
              {{ 'COMMON.UNDO' | translate }}
            </button>
          </div>
          <button type="button" class="btn link back" cdkStepperPrevious>
            <i class="vitamui-icon vitamui-icon-chevron-left"></i>
            <span class="underline">{{ 'COMMON.BACK' | translate }}</span>
          </button>
        </div>
      </div>
    </cdk-step>

    <!-- STEP 9 - Versement de documents signés -->
    <cdk-step>
      <div class="content">
        <h4>{{ 'INGEST_CONTRACT.MODAL_CREATE.TITLE' | translate }}</h4>
        <h2>{{ 'INGEST_CONTRACT.MODAL_CREATE.SIGNING_POLICY.TITLE' | translate }}</h2>
        <div class="main-content" formGroupName="signaturePolicy">
          <div class="row">
            <mat-button-toggle-group formControlName="signedDocument" #group="matButtonToggleGroup"
                                     class="vitamui-button-toggle-group">
              <mat-button-toggle value="{{ signedDocumentPolicyEnum.ALLOWED }}">
                {{ 'INGEST_CONTRACT.SIGNED_DOCUMENT_TYPE.' + signedDocumentPolicyEnum.ALLOWED  | translate }}
              </mat-button-toggle>
              <mat-button-toggle value="{{ signedDocumentPolicyEnum.ONLY }}">
                {{ 'INGEST_CONTRACT.SIGNED_DOCUMENT_TYPE.' + signedDocumentPolicyEnum.ONLY  | translate }}
              </mat-button-toggle>
              <mat-button-toggle value="{{ signedDocumentPolicyEnum.FORBIDDEN }}">
                {{ 'INGEST_CONTRACT.SIGNED_DOCUMENT_TYPE.' + signedDocumentPolicyEnum.FORBIDDEN  | translate }}
              </mat-button-toggle>
            </mat-button-toggle-group>
          </div>
          <div class="row">
            <p class="title-text">{{ 'INGEST_CONTRACT.MODAL_CREATE.SIGNING_POLICY.ELEMENTS_TO_CHECK' | translate}}</p>
          </div>
          <div class="row">
            <div class="col">
              <div class="criteria-checkbox-choice">
                <label>
                  <input type="checkbox"
                         id="SIGNED_DOCUMENT"
                  />
                  <span>{{ 'INGEST_CONTRACT.ELEMENT_TO_CHECK.SIGNED_DOCUMENT' | translate }}</span>
                </label>
              </div>
              <div class="criteria-checkbox-choice">
                <label>
                  <input type="checkbox"
                         id="needSignature"
                         formControlName="needSignature"
                  />
                  <span>{{ 'INGEST_CONTRACT.ELEMENT_TO_CHECK.SIGNATURE' | translate }}</span>
                </label>
              </div>
              <div class="criteria-checkbox-choice">
                <label>
                  <input type="checkbox"
                         id="TIMESTAMP"
                         formControlName="needTimestamp"
                  />
                  <span>{{ 'INGEST_CONTRACT.ELEMENT_TO_CHECK.TIMESTAMP' | translate }}</span>
                </label>
              </div>
              <div class="criteria-checkbox-choice">
                <label>
                  <input type="checkbox"
                         id="ADDITIONAL_EVIDENCES"
                         formControlName="needAdditionalProof"
                  />
                  <span>{{ 'INGEST_CONTRACT.ELEMENT_TO_CHECK.ADDITIONAL_EVIDENCES' | translate }}</span>
                </label>
              </div>
            </div>
          </div>
        </div>
        <div class="actions">
          <div class="line">
            <button type="submit" class="btn primary" [disabled]="selectedSignedDocumentPolicyInvalid()">
              {{ 'COMMON.SUBMIT' | translate }}
            </button>
            <button type="button" class="btn link" (click)="onCancel()">
              {{ 'COMMON.UNDO' | translate }}
            </button>
          </div>
          <button type="button" class="btn link back" cdkStepperPrevious>
            <i class="vitamui-icon vitamui-icon-chevron-left"></i>
            <span class="underline">{{ 'COMMON.BACK' | translate }}</span>
          </button>
        </div>
      </div>
    </cdk-step>

  </vitamui-common-stepper>
</form>
