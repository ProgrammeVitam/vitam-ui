<div class="flex-row">
  <div class="tree-text">
    <div class="tree-title">
      <span>{{ 'ARCHIVE_SEARCH.FILING_SHCEMA.TREE_LEAVES_TITLE' | translate }}</span>
      <mat-spinner diameter="20" color="accent" *ngIf="loadingNodeUnit || loadingNodesDetails"></mat-spinner>
    </div>
  </div>
</div>

<div class="tree-filing-scheme">
  <mat-tree [dataSource]="nestedDataSourceLeaves" [treeControl]="nestedTreeControlLeaves" class="filing-holding-scheme-tree">
    <mat-nested-tree-node *matTreeNodeDef="let node; when: nodeIsUAWithChildren">
      <div *ngIf="nodeHasResultOrShowAll(node)" class="mat-tree-node filing-holding-scheme-tree-node flex-row">
        <vitamui-tree-node
          [node]="node"
          [icon]="getNodeUnitIcone(node)"
          (labelClick)="onLabelClick(node.id)"
          (checkboxClick)="addToSearchCriteriaList(node)"
          [expanded]="nestedTreeControlLeaves.isExpanded(node)"
          (nodeToggle)="toggleLeave(node)"
        >
        </vitamui-tree-node>
        <span *ngIf="nodeHasPositiveCount(node)" class="badge badge-secondary pad">
          {{ node.count | number : '1.0' }}
        </span>
      </div>
      <div
        *ngIf="nodeHasResultOrShowAll(node)"
        [class.filing-holding-scheme-tree-invisible]="!nestedTreeControlLeaves.isExpanded(node)"
        class="flex-column childs"
      >
        <ng-container matTreeNodeOutlet *ngIf="nestedTreeControlLeaves.isExpanded(node)"> </ng-container>
        <div *ngIf="node.isLoadingChildren">
          <mat-spinner diameter="20" color="accent"></mat-spinner>
        </div>
        <div *ngIf="canLoadMoreUAForNode(node) && nestedTreeControlLeaves.isExpanded(node)">
          <a class="load-more-ua" (click)="toggleLoadMore(node)">
            {{ 'ARCHIVE_SEARCH.FILING_SHCEMA.LOAD_MORE_UNITS' | translate }}
          </a>
        </div>
      </div>
    </mat-nested-tree-node>

    <mat-tree-node *matTreeNodeDef="let node; when: nodeIsUAWithoutChildren">
      <div *ngIf="nodeHasResultOrShowAll(node)" class="mat-tree-node filing-holding-scheme-tree-node flex-row">
        <div class="tree-text">
          <vitamui-tree-node
            disabled
            [node]="node"
            [icon]="getNodeUnitIcone(node)"
            (labelClick)="onLabelClick(node.id)"
            (checkboxClick)="addToSearchCriteriaList(node)"
            (nodeToggle)="nestedTreeControlLeaves.toggle(node)"
          >
          </vitamui-tree-node>
        </div>
        <span *ngIf="nodeHasPositiveCount(node)" class="badge badge-secondary pad">
          {{ node.count | number : '1.0' }}
        </span>
      </div>
    </mat-tree-node>

    <mat-nested-tree-node *matTreeNodeDef="let node">
      <div *ngIf="nodeHasResultOrShowAll(node)" class="mat-tree-node filing-holding-scheme-tree-node">
        <vitamui-tree-node
          [node]="node"
          [icon]="getNodeUnitIcone(node)"
          (labelClick)="onLabelClick(node.id)"
          (checkboxClick)="addToSearchCriteriaList(node)"
          [expanded]="nestedTreeControlLeaves.isExpanded(node)"
          (nodeToggle)="toggleLeave(node)"
        >
        </vitamui-tree-node>
        <span *ngIf="nodeHasPositiveCount(node)" class="badge badge-secondary pad">
          {{ node.count | number : '1.0' }}
        </span>
      </div>
      <div
        *ngIf="nodeHasResultOrShowAll(node)"
        [class.filing-holding-scheme-tree-invisible]="!nestedTreeControlLeaves.isExpanded(node)"
        class="flex-column childs"
      >
        <ng-container matTreeNodeOutlet *ngIf="!node.isLoadingChilds && nestedTreeControlLeaves.isExpanded(node)"> </ng-container>
        <div *ngIf="node.isLoadingChildren">
          <mat-spinner diameter="20" color="accent"></mat-spinner>
        </div>
        <div *ngIf="canLoadMoreUAForNode(node) && nestedTreeControlLeaves.isExpanded(node)">
          <a class="load-more-ua" (click)="toggleLoadMore(node)">
            {{ 'ARCHIVE_SEARCH.FILING_SHCEMA.LOAD_MORE_UNITS' | translate }}
          </a>
        </div>
      </div>
    </mat-nested-tree-node>
  </mat-tree>
</div>

<div class="tree-text">
  <a class="tree-show-link" (click)="switchViewAllNodes()">
    {{
      (this.showEveryNodes ? 'ARCHIVE_SEARCH.FILING_SHCEMA.SHOW_TREE_PARENT' : 'ARCHIVE_SEARCH.FILING_SHCEMA.SHOW_ENTIRE_TREE') | translate
    }}
  </a>
</div>
