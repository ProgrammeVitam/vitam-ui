<div class="flex-row">
  <div class="tree-text">
    <p>{{'ARCHIVE_SEARCH.FILING_SHCEMA.TREE_LEAVES_TITLE' | translate}}</p>
  </div>
</div>

<div class="tree-filing-scheme">
  <mat-tree [dataSource]="nestedDataSourceLeaves" [treeControl]="nestedTreeControlLeaves"
            class="filing-holding-scheme-tree">

    <mat-nested-tree-node *matTreeNodeDef="let node; when nodeIsUAWithChidren">
      <div *ngIf="nodeHasResultOrShowAll(node)" class="mat-tree-node filing-holding-scheme-tree-node flex-row">
        <app-filing-holding-node [node]="node"
                                 [expanded]="nestedTreeControlLeaves.isExpanded(node)"
                                 (nodeToggle)="toggleLeave(node)">
        </app-filing-holding-node>
        <span *ngIf="nodeHasPositivCount(node)" class="badge badge-secondary pad">
         {{node.count | number : '1.0'}}
        </span>
      </div>
      <div *ngIf="nodeHasResultOrShowAll(node)" [class.filing-holding-scheme-tree-invisible]="!nestedTreeControlLeaves.isExpanded(node)"
           class="flex-column childs">
        <ng-container matTreeNodeOutlet *ngIf="nestedTreeControlLeaves.isExpanded(node)">
        </ng-container>
        <div *ngIf="node.isLoadingChildren">
          <mat-spinner diameter="20" color="accent"></mat-spinner>
        </div>
        <div *ngIf="canLoadMoreUAForNode(node) && nestedTreeControlLeaves.isExpanded(node)">
          <a class="load-more-ua " (click)="loadMoreUAForNode(node)">
            {{'ARCHIVE_SEARCH.FILING_SHCEMA.LOAD_MORE_UNITS' | translate}}
          </a>
        </div>
      </div>
    </mat-nested-tree-node>

    <mat-tree-node *matTreeNodeDef="let node; when nodeIsUAWithoutChidren">
      <div *ngIf="nodeHasResultOrShowAll(node)" class="mat-tree-node filing-holding-scheme-tree-node flex-row">
        <div class="tree-text">
          <app-filing-holding-node disabled [node]="node"
                                   (nodeToggle)="nestedTreeControlLeaves.toggle(node)">
          </app-filing-holding-node>
        </div>
        <span *ngIf="nodeHasPositivCount(node)" class="badge badge-secondary pad">
         {{node.count | number : '1.0'}}
        </span>
      </div>
    </mat-tree-node>

    <mat-nested-tree-node *matTreeNodeDef="let node;">
      <div *ngIf="nodeHasResultOrShowAll(node)" class="mat-tree-node filing-holding-scheme-tree-node">
        <app-filing-holding-node [node]="node"
                                 [expanded]="nestedTreeControlLeaves.isExpanded(node)"
                                 (nodeToggle)="toggleLeave(node)">
        </app-filing-holding-node>
        <span *ngIf="nodeHasPositivCount(node)" class="badge badge-secondary pad">
         {{node.count | number : '1.0'}}
        </span>
      </div>
      <div *ngIf="nodeHasResultOrShowAll(node)"
            [class.filing-holding-scheme-tree-invisible]="!nestedTreeControlLeaves.isExpanded(node)"
        class="flex-column childs">
        <ng-container matTreeNodeOutlet *ngIf="!node.isLoadingChilds && nestedTreeControlLeaves.isExpanded(node)">
        </ng-container>
        <div *ngIf="node.isLoadingChildren">
          <mat-spinner diameter="20" color="accent"></mat-spinner>
        </div>
        <div *ngIf="canLoadMoreUAForNode(node) && nestedTreeControlLeaves.isExpanded(node)">
          <a class="load-more-ua" (click)="loadMoreUAForNode(node)">
            {{'ARCHIVE_SEARCH.FILING_SHCEMA.LOAD_MORE_UNITS' | translate}}
          </a>
        </div>
      </div>
    </mat-nested-tree-node>

    <!--
    <mat-tree-node style="display: none;" *matTreeNodeDef="let node;">
      !-- default is hidden node. --
    </mat-tree-node>
    -->

  </mat-tree>
</div>

<div class="tree-text">
  <a class="tree-show-link" (click)="switchViewAllNodes()">
    {{(this.showEveryNodes ? 'ARCHIVE_SEARCH.FILING_SHCEMA.SHOW_TREE_PARENT' : 'ARCHIVE_SEARCH.FILING_SHCEMA.SHOW_ENTIRE_TREE') | translate}}
  </a>
</div>
