<!--
  ~ Copyright French Prime minister Office/SGMAP/DINSIC/Vitam Program (2015-2022)
  ~
  ~ contact.vitam@culture.gouv.fr
  ~
  ~ This software is a computer program whose purpose is to implement a digital archiving back-office system managing
  ~ high volumetry securely and efficiently.
  ~
  ~ This software is governed by the CeCILL 2.1 license under French law and abiding by the rules of distribution of free
  ~ software. You can use, modify and/ or redistribute the software under the terms of the CeCILL 2.1 license as
  ~ circulated by CEA, CNRS and INRIA at the following URL "https://cecill.info".
  ~
  ~ As a counterpart to the access to the source code and rights to copy, modify and redistribute granted by the license,
  ~ users are provided only with a limited warranty and the software's author, the holder of the economic rights, and the
  ~ successive licensors have only limited liability.
  ~
  ~ In this respect, the user's attention is drawn to the risks associated with loading, using, modifying and/or
  ~ developing or reproducing the software by the user in light of its specific status of free software, that may mean
  ~ that it is complicated to manipulate, and that also therefore means that it is reserved for developers and
  ~ experienced professionals having in-depth computer knowledge. Users are therefore encouraged to load and test the
  ~ software's suitability as regards their requirements in conditions enabling the security of their systems and/or data
  ~ to be ensured and, more generally, to use and operate it in the same conditions as regards security.
  ~
  ~ The fact that you are presently reading this means that you have had knowledge of the CeCILL 2.1 license and that you
  ~ accept its terms.
  ~
  -->
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/>
  <meta charset="UTF-8"/>
  <title th:text="${@environment.getProperty('theme.vitamui-platform-name')}">VITAM-UI</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/x-icon" href="../static/images/favicon.ico"
        th:href="${application.vitamuiFavicon} ? 'data:image/png;base64,' + ${application.vitamuiFavicon} : @{/images/favicon.ico}"/>
  <link rel="stylesheet" type="text/css" href="../static/css/cas.css"
        th:href="@{/css/cas.css}"/>
  <link rel="stylesheet" type="text/css" href="../static/icons/vitamui-icons.css"
        th:href="@{/icons/vitamui-icons.css}"/>
  <script type="text/javascript" src="../../../../../../deployment/roles/reverse/files/apache/page/js/jquery.min.js"
          th:src="@{#{webjars.jquery.js}}"></script>
  <script type="text/javascript"
          th:src="@{#{webjars.jqueryui.js}}"></script>
  <script type="text/javascript" src="../static/js/cas.js"
          th:src="@{#{/js/cas.js}}"></script>
</head>

<body style="--vitamui-primary:#9C31B5;--vitamui-secondary:#7FA1D4;--vitamui-background:#F6F3FB;"
      th:st="${@environment.getProperty('theme.body.style')}">
<div class="centered">
  <div class="logo">
    <img src="../static/images/logo-vitam-colored.svg" alt="logo"
         th:src="${application.vitamuiLargeLogo} ? 'data:image/png;base64,' + ${application.vitamuiLargeLogo} : @{/images/logo-vitam-colored.svg}">
  </div>
  <div class="vitamui-card">


    <div class="step-subrogation col" th:if="${!#strings.isEmpty(superUser)}">
      <div class="Text-large-bold">
        Subrogation
      </div>
      <!--suppress XmlDuplicatedId -->
      <form id="main-form" class="margin-top-10" method="post" th:object="${credential}" action="login">
        <input type="hidden" name="execution" th:value="${flowExecutionKey}"/>
        <input type="hidden" name="_eventId" value="submit"/>
        <!--suppress XmlDuplicatedId -->
        <input type="hidden" id="username" name="username" th:value="${surrogate + ',' + superUser}"/>
        <div class="form-line">
          <div class="Text-medium-bold" th:text="#{screen.welcome.label.surrogate}">Subrogé : &nbsp;</div>
          <div class="Text-medium" th:text="${surrogate}">admin@societedugrandparis.fr</div>
        </div>
        <div class="form-line">
          <div class="Text-medium-bold" th:text="#{screen.welcome.label.superuser}">Super utilisateur :&nbsp;</div>
          <div class="Text-medium" th:text="${superUser}">superadmin@programmevitam.fr</div>
        </div>
      </form>
    </div>


    <div class="step-email col" th:if="${#strings.isEmpty(superUser)}">
      <div class="Headline-3" th:text="#{cas.welcome.header.msg}">
        Bienvenue
      </div>
      <div class="Text-large-bold margin-top-20"
           th:text="#{cas.authentication.email.input}">
        Veuillez saisir votre adresse e-mail
      </div>
      <div class="Text-medium Grey-600 row margin-top-5"
           th:text="#{cas.authentication.email.forgot}">
        Vous avez oublié votre identifiant ?&nbsp;Contactez votre administrateur.
      </div>
      <!--suppress XmlDuplicatedId -->
      <form id="main-form" class="margin-top-10" method="post" th:object="${credential}" action="login">
        <input type="hidden" name="execution" th:value="${flowExecutionKey}"/>
        <input type="hidden" name="_eventId" value="submit"/>
        <div class="form-line">
          <!--suppress XmlDuplicatedId -->
          <input id="username"
                 type="text"
                 name="email"
                 autofocus
                 size="25"
                 tabindex="1"
                 autocomplete="off"
                 required
                 th:disabled="${guaEnabled}"
                 th:accesskey="#{screen.welcome.label.netid.accesskey}"
                 th:field="*{username}"
          />
          <label for="username" th:text="#{cas.authentication.email.placeholder}">
            Adresse e-mail *
          </label>
        </div>
        <div class="warning Caption" th:if="${#fields.hasErrors('*')}">
          <i class="vitamui-icon vitamui-icon-anomalie"></i>
          <div class="col">
            <div class="element" th:each="err : ${#fields.errors('*')}" th:text="${err}">
              Exemple d'erreur
            </div>
          </div>
        </div>
        <input th:if="${param.doChangePassword != null}" type="hidden" name="doChangePassword" id="doChangePassword"
               value="true"/>
      </form>
    </div>

    <div class="button-footer">
      <button id="submit-main-form" class="Button" type="submit" form="main-form">VALIDER</button>
    </div>

  </div>

</div>

<div th:if="${logoutUrls}">
  <div th:each="entry : ${logoutUrls}">
    <script type="text/javascript" th:inline="javascript">
      /*<![CDATA[*/
      $.ajax({
        url: [[${entry.key.logoutUrl.toExternalForm()}]],
        dataType: 'jsonp',
        async: true,
        contentType: [[${entry.value.contentType}]]
        , data: [[${entry.value.message}]]
        , success: function (data) {
        },
        error: function (err, textStatus, errorThrown) {
        }
      });
      /*]]>*/
    </script>
  </div>
</div>

<script th:inline="javascript" th:if="${!#strings.isEmpty(providedUsername)}">
  var providedUsername = /*[[${providedUsername}]]*/ "";
  $(document).ready(function () {
    $('#username').val(providedUsername);
  });
</script>
<script>
  $('#main-form').submit(function () {
    $(this).find('#username').each(function () {
      $(this).val($.trim($(this).val()));
    });
  });
</script>
</body>
</html>
