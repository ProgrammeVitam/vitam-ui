---

- name: 'Frontend-app > install.yml | Purge existing folder'
  file:
    path: "{{ frontend_data_dir }}"
    state: absent
  when: frontend_purge
  become: true

- name: 'Frontend-app > install.yml | Create folder'
  file:
    path: "{{ frontend_data_dir }}"
    state: directory
    owner: "{{ frontend_user }}"
    group: "{{ frontend_group }}"
    mode: 0755
  become: true


#install by yum the ressources


- name: "Frontend-app > install.yml | Add configuration files"
  template:
    src: "frontend/{{ item.filename }}"
    dest: "{{ item.destination }}"
    group: "{{ frontend_group }}"
    owner: "{{ frontend_user }}"
  with_items:
  - { filename: "config.json.j2", destination: "{{ frontend_root_path }}/data/{{ frontend_application.name }}/package/assets/config.json"}
  - { filename: "vhost.conf.j2", destination: "/etc/nginx/conf.d/{{ frontend_application.name }}.conf"}
  become: true

- name: "Frontend-app > install.yml | Add certificate"
  copy:
    src: "{{ item }}"
    dest: "{{ nginx_ssl_dir }}"
    group: "{{ frontend_group }}"
    owner: "{{ frontend_user }}"
  with_fileglob:
    - "{{ frontend_application.certificate }}" #TODO GET PATH FOR CERT
  become: true

- name: "Frontend-app > install.yml | Add keypass"
  template:
    src: "certificate.key_pass.j2"
    dest: "{{ nginx_ssl_dir }}/{{vitamui_struct.vitamui_component}}.key_pass"
    group: "{{ frontend_group }}"
    owner: "{{ frontend_user }}"
  when: frontend_application.key_pass is defined
  become: true

- name: "Frontend-app > install.yml | Reload nginx"
  become: true
  service:
    name: nginx
    state: "reloaded"
  when: frontend_proxy_reload is sameas true
