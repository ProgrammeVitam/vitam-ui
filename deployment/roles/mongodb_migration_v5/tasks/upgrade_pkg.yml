---

- name: "Remove old mongodb-org-tools (otherwise conflict with 5.0.x version)"
  package:
    name:
      - 'mongodb-org-tools'
    state: absent
  register: result
  retries: "{{ packages_install_retries_number | default(2) }}"
  until: result is succeeded
  delay: "{{ packages_install_retries_delay | default(10) }}"

- name: "Upgrade mongo packages & vitamui-mongod"
  package:
    name:
      - 'mongodb-org'
      - 'mongodb-org-database-tools-extra'
      - 'mongodb-org-server'
      - 'mongodb-org-shell'
      - 'vitamui-mongod'
    state: latest
  register: result
  retries: "{{ packages_install_retries_number | default(2) }}"
  until: result is succeeded
  delay: "{{ packages_install_retries_delay | default(10) }}"

- name: "Start vitam-mongo service"
  systemd:
    name: vitamui-mongod
    daemon_reload: yes
    state: restarted
    enabled: {{ mongodb.at_boot | default(service_at_boot) }}
