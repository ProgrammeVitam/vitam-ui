---

- name: Copy reconfiguration database script when primary
  copy:
    src: "reconfig.js"
    dest: "{{ vitamui_defaults.folder.root_path | default('/vitamui') }}/app/{{ mongo_type }}"
    owner: "{{ vitamui_defaults.users.vitamuidb | default('vitamuidb') }}"
    group: "{{ vitamui_defaults.users.group | default('vitamui') }}"
    mode: "{{ vitamui_defaults.folder.conf_permission | default('0440') }}"

- name: Reconfigure replicaset for mongod
  shell: "mongo --host {{ ip_service }} --port {{ mongo_port }} -u {{ mongodb.localadmin.user }} -p {{ mongodb.localadmin.password }} --quiet < {{ vitamui_defaults.folder.root_path | default('/vitamui') }}/app/mongod/reconfig.js"
  when:
    - mongo_type == 'mongod'
