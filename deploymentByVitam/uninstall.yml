- hosts: localhost
  connection: local
  become: false
  roles:
    - bootstrap_ansible

- hosts: hosts_vitamui
  gather_facts: false

  tasks:
    - name: Stop all vitamui services
      shell: "systemctl stop vitam*"
      ignore_errors: yes

    - name: Stop all dlab services
      shell: "systemctl stop dlab*"
      ignore_errors: yes

    # Uninstalling package will remove systemd unit files
    - name: Uninstall vitamui packages
      yum:
        name: "vitam*"
        state: removed
      ignore_errors: yes

    - name: Reload systemd
      command: systemctl daemon-reload

    - name: Clean systemd
      command: systemctl reset-failed

#    - name: Remove yum repository
#      file:
#        path: "/etc/yum.repos.d/{{ item }}.repo"
#        state: absent
#      with_items:
#        - dlab
#        - logstash
#        - mongo

    - name: Clean repository metadata
      shell: yum clean metadata
      ignore_errors: yes

    - name: Ensure yum cache is reset
      command: yum makecache
      ignore_errors: yes

    - name: Remove vitamui file system
      command: rm -Rf /vitamui
      ignore_errors: yes

    - name: Remove vitam file system
      command: rm -Rf /vitam
      ignore_errors: yes
